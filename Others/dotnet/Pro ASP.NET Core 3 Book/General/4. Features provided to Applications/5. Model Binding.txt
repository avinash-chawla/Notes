
----------------------------------------------------------------------------------------

1. What is Model Binding?

--> Model binding is the process of creating .NET objects using the values from the HTTP request to provide easy access to the data required by action methods and Razor Pages. 

--> Data can be obtained without model binding using context objects. However, the result is more complicated code that is hard to read and maintain.

----------------------------------------------------------------------------------------

2. Location

--> The default model binders look for data values in these four places: 

1. Form data
2. The request body (only for controllers decorated with ApiController)
3. Routing segment variables
4. Query strings

--> The model binder will try to get values for method parameters but will still invoke the method if data values cannot be located. 

----------------------------------------------------------------------------------------

3. Model Binding for Razor Pages

--> Care must be taken to ensure that the value of the form element’s name attribute matches the name of the handler method parameter
--> This may not be the case if the asp-for attribute has been used to select a nested property. 

--> To ensure the names match, the name attribute can be defined explicitly


<input class="form-control" asp-for="Product.Name" name="name"/>
<input class="form-control" asp-for="Product.Price" name="price" />

@functions{
	..
        public IActionResult OnPost(string name, decimal price) {
            ...
        }
}

----------------------------------------------------------------------------------------

4. Binding Complex Types for Controllers

--> The model binding system shines when dealing with complex types

        [HttpPost]
        public IActionResult SubmitForm(Product product) {
            TempData["product"] = System.Text.Json.JsonSerializer.Serialize(product);
            return RedirectToAction(nameof(Results));
        }

--> Before the action method is invoked, a new Product object is created, and the model binding process is applied to each of its public properties
--> The Product object created by the model binding process is serialized as JSON data so that it can be stored as temp data, making it easy to see the request data.

----------------------------------------------------------------------------------------

5. Binding Complex Types for Razor Pages


--> Using parameters for model binding doesn’t fit with the Razor Pages development style because the parameters often duplicate properties defined by the page model class

        public IActionResult OnPost(Product product) {
            TempData["product"] = System.Text.Json.JsonSerializer.Serialize(product);
            return RedirectToPage("FormResults");
        }

--> This code works, but the OnPost handler method has its own version of the Product object, mirroring the property used by the OnGetAsync handler. 
--> A more elegant approach is to use the existing property for model binding

----------------------------------------------------------------------------------------

--> Using a Property for Model Binding in the FormHandler.cshtml File in the Pages Folder

<input class="form-control" asp-for="Product.Name" />
<input class="form-control" asp-for="Product.Price"  />

@functions {
	..
        [BindProperty]
        public Product Product { get; set; }

        public IActionResult OnPost() {
            TempData["product"] = System.Text.Json.JsonSerializer.Serialize(Product);
            return RedirectToPage("FormResults");
        }

	..
}

--> Decorating a property with the BindProperty attribute indicates that its properties should be subject to the model binding process, which means the OnPost handler method can get the data it requires without declaring a parameter. 

--> By default, BindProperty won’t bind data for GET requests, but this can be changed by setting the BindProperty attribute’s SupportsGet argument to true.

--> The BindProperties attribute can be applied to classes that require the model binding process for all the public properties they define, which can be more convenient than applying BindProperty to many individual properties.
--> Decorate properties with the BindNever attribute to exclude them from model binding.

----------------------------------------------------------------------------------------

6. Binding Nested Complex Types

--> For example, the Product class defines the Category property, whose type is the complex Category type
--> During the model binding process, a new Category object is created and assigned to the Category property of the Product object. 

----------------------------------------------------------------------------------------

7. Specifying Custom Prefixes for Nested Complex Types

--> There are occasions when the HTML you generate relates to one type of object but you want to bind it to another.
--> Product has a complex property Category

[HttpPost] 
public IActionResult SubmitForm(Category category) {..}

--> This problem is solved by applying the Bind attribute to the parameter

[HttpPost] 
public IActionResult SubmitForm([Bind(Prefix ="Category")] Category category) {..}

----------------------------------------------------------------------------------------

--> For Razor Pages

--> When using the BindProperty attribute, the prefix is specified using the Name argument

        <div class="form-group">
            <label>Category Name</label>
            <input class="form-control" asp-for="Product.Category.Name"  />
        </div>

@functions {
    public class FormHandlerModel : PageModel {
        ..
	[BindProperty(Name = "Product.Category")]
        public Category Category { get; set; }

        public IActionResult OnPost() {
            TempData["product"] = System.Text.Json.JsonSerializer.Serialize(Product);
            TempData["category"] = System.Text.Json.JsonSerializer.Serialize(Category);
            return RedirectToPage("FormResults");
        }
}

----------------------------------------------------------------------------------------

8. Selectively Binding Properties

--> Some model classes define properties that are sensitive and for which the user should not be able to specify values. 
--> A user may be able to change the category for a Product object, for example, but should not be able to alter the price.


--> To prevent the model binder from using values for sensitive properties, the list of properties that should be bound can be specified

        [HttpPost]
        public IActionResult SubmitForm([Bind("Name", "Category")] Product product) {
            TempData["name"] = product.Name;
            TempData["price"] = product.Price.ToString();
            TempData["category name"] = product.Category.Name;
            return RedirectToAction(nameof(Results));
        }

--> Even though the browser sends a value for the Price property as part of the HTTP POST request, it is ignored by the model binder

----------------------------------------------------------------------------------------

9. Selectively Binding in the Model Class

--> Use BindNever attribute

	[Column(TypeName = "decimal(8, 2)")]
        [BindNever]
        public decimal Price { get; set; }

----------------------------------------------------------------------------------------

10. Specifying a Model Binding Source

1. FromForm
2. FromRoute
3. FromQuery
4. FromHeader
5. FromBody

----------------------------------------------------------------------------------------

	public async Task<IActionResult> Index([FromQuery] long? id) {..}

----------------------------------------------------------------------------------------

        public string Header([FromHeader]string accept) {
            return $"Header: {accept}";
        }

----------------------------------------------------------------------------------------

        [HttpPost]
        public Product Body([FromBody] Product model) {
            return model;
        }

----------------------------------------------------------------------------------------

--> For Razor Page

@functions {
    public class BindingsModel : PageModel {
        //[BindProperty(Name = "Data")]
        [FromQuery(Name = "Data")]
        public Product[] Data { get; set; } = Array.Empty<Product>();
    } 
}

----------------------------------------------------------------------------------------

11. Manually Model Binding

@functions {
    public class BindingsModel : PageModel {
        public Product Data { get; set; } = new Product() { Name = "Skis", Price = 500 };

        public async Task OnPostAsync([FromForm] bool bind) {
            if (bind) {
               await TryUpdateModelAsync<Product>(Data, "data", p => p.Name, p => p.Price);
            }
        }
    } 
}

--> Manual model binding is performed using the TryUpdateModelAsync method, which is provided by the PageModel and ControllerBase classes, which means it is available for both Razor Pages and MVC controllers. 

--> This example mixes automatic and manual model binding. 

--> The arguments to the TryUpdateModelAsync method are the object that will be model bound, the prefix for the values, and a series of expressions that select the properties that will be included in the process, although there are other versions of the TryUpdateModelAsync method available.

----------------------------------------------------------------------------------------

12. The End

----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



































