
----------------------------------------------------------------------------------------

1. What is Model Validation?

--> Model Validation is a process for inspecting the model data which is provided by user.
--> It can lead to exceptions and unexpected behavior that appear immediately or long-term problems that appear gradually as the database is populated with bad, incomplete, or malicious data.

----------------------------------------------------------------------------------------

2. Explicitly Validating Data in a Controller

----------------------------------------------------------------------------------------

3. ModelState property

--> ModelState property is inherited from the ControllerBase class
--> This property returns ModelStateDictionary object

--> Members of this object

1. AddModelError(property, message) 
2. GetValidationState(property) 	
3. IsValid					
4. Clear()	

----------------------------------------------------------------------------------------

4. Displaying Validation Errors to the User

--> Context data provided to the view contains details of the model validation errors

<div asp-validation-summary="All" class="text-danger"></div>

--> The ValidationSummaryTagHelper class detects the asp-validation-summary attribute on div elements and responds by adding messages that describe any validation errors that have been recorded. 
--> The value of the asp-validation-summary attribute is a value from the ValidationSummary enumeration, which defines the values

----------------------------------------------------------------------------------------

--> The ValidationSummary Values

All	   
ModelOnly 
None	  

----------------------------------------------------------------------------------------

5. Displaying Property-Level Validation Messages

--> This can be done using the ValidationMessageTag tag helper, which looks for span elements that have the asp-validation-for attribute

--> For this kind of error, it is more useful to display the validation error messages alongside the HTML elements that contain the problem data. 

<div><span asp-validation-for="Name" class="text-danger"></span></div>
<div><span asp-validation-for="Price" class="text-danger"></span></div>
<div><span asp-validation-for="CategoryId" class="text-danger"></span></div>

----------------------------------------------------------------------------------------

6. Displaying Model-Level Messages

--> It excludes property-level errors

<div asp-validation-summary="ModelOnly" class="text-danger"></div>

----------------------------------------------------------------------------------------

7. Specifying Validation Rules Using Metadata

        [Required(ErrorMessage = "Please enter a price")]
        [Range(1, 999999, ErrorMessage = "Please enter a positive price")]
        public decimal Price { get; set; }

----------------------------------------------------------------------------------------

8. The Built-in Validation Attributes

[Compare("OtherProperty")]
[Range(10, 20)]
[RegularExpression("pattern")]
[Required]	
[StringLength(10)]

--> All the validation attributes support specifying a custom error message by setting a value for the ErrorMessage property

----------------------------------------------------------------------------------------

9. Validation for Checkboxes

--> You cannot use the Required attribute
--> Instead, use the Range attribute and specify the minimum and maximum values as true, like this: 

... 
[Range(typeof(bool), "true", "true", ErrorMessage="You must check the box")]

----------------------------------------------------------------------------------------

10. Web Service Controller Validation

--> Controllers that have been decorated with the ApiController attribute do not need to check the ModelState.IsValid property. 
--> Instead, the action method is invoked only if there are no validation errors, which means you can always rely on receiving validated objects through the model binding feature.

----------------------------------------------------------------------------------------

11. Custom Property Validation Attribute

--> The validation process can be extended by creating an attribute that extends the ValidationAttribute class.

using Microsoft.EntityFrameworkCore; 
using System; 
using System.ComponentModel.DataAnnotations;

namespace WebApp.Validation {

    public class PrimaryKeyAttribute : ValidationAttribute {

        public Type ContextType { get; set; }

        public Type DataType { get; set; }

        protected override ValidationResult IsValid(object value, ValidationContext validationContext) {
            DbContext context = validationContext.GetService(ContextType) as DbContext;
            if (context.Find(DataType, value) == null) {
                return new ValidationResult(ErrorMessage ?? "Enter an existing key value");
            } else {
                return ValidationResult.Success;
            }
        }
    }
}

----------------------------------------------------------------------------------------

--> Another Example

using System; 
using System.ComponentModel.DataAnnotations; 
using WebApp.Models;

namespace WebApp.Validation {

    public class PhraseAndPriceAttribute: ValidationAttribute {

        public string Phrase { get; set; }

        public string Price { get; set; }

        protected override ValidationResult IsValid(object value, ValidationContext validationContext) {
            Product product = value as Product;
            if (product != null 
		&& product.Name.StartsWith(Phrase, StringComparison.OrdinalIgnoreCase)
                && product.Price > decimal.Parse(Price)) 

		{
                    return new ValidationResult(ErrorMessage ?? $"{Phrase} products cannot cost more than ${Price}");
            }
            return ValidationResult.Success;
        }
    } 
}

----------------------------------------------------------------------------------------

namespace WebApp.Models {

    [PhraseAndPrice(Phrase ="Small", Price = "100")]
    public class Product {

    	[PrimaryKey(ContextType= typeof(DataContext), DataType = typeof(Category))]
        public long CategoryId { get; set; }

        [PrimaryKey(ContextType = typeof(DataContext), DataType = typeof(Category))]
        public long SupplierId { get; set; }

----------------------------------------------------------------------------------------

12. Performing Client-Side Validation

libman install jquery-validate@1.19.1 -d wwwroot/lib/jquery-validate 
libman install jquery-validation-unobtrusive@3.2.11 -d wwwroot/lib/jquery-validation-unobtrusive

<script src="/lib/jquery/jquery.min.js"></script> 
<script src="~/lib/jquery-validate/jquery.validate.min.js"></script> 
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"> </script> 

--> The JavaScript code looks for elements with the data-val attribute and performs local validation in the browser when the user submits the form, without sending an HTTP request to the server.

----------------------------------------------------------------------------------------

13. Performing Remote Validation

        [HttpGet("categorykey")]
        public bool CategoryKey(string categoryId) {
            long keyVal;
            return long.TryParse(categoryId, out keyVal) && dataContext.Categories.Find(keyVal) != null;
        }

        [HttpGet("supplierkey")]
        public bool SupplierKey(string supplierId) {
            long keyVal;
            return long.TryParse(supplierId, out keyVal) && dataContext.Suppliers.Find(keyVal) != null;
        }

--> Validation action methods must define a parameter whose name matches the field they will validate, which allows the model binding process to extract the value to test from the request query string. 

--> The response from the action method must be JSON and can be only true or false, indicating whether a value is acceptable

----------------------------------------------------------------------------------------

[Remote("CategoryKey", "Validation", ErrorMessage = "Enter an existing key")]
public long CategoryId { get; set; }

[Remote("SupplierKey", "Validation", ErrorMessage = "Enter an existing key")]
public long SupplierId { get; set; }

--> The arguments to the Remote attribute specify the name of the validation controller and its action method. 
--> I have also used the optional ErrorMessage argument to specify the error message that will be displayed when validation fail

----------------------------------------------------------------------------------------

14. Remote Validation in Razor Pages

----------------------------------------------------------------------------------------

15. The End

----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------


































